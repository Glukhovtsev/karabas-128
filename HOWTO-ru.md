# Описание процесса сборки:

Процесс сборки желательно начать с монтажа SMD-компонентов: IC10, IC11, IC13, L1, C3, C37, C38, C39, C40. Для запаивания CPLD Altera EPM7128STC100 желательно иметь паяльную станцию с жалом типа "***микроволна***", микросхема позиционируется на посадочном месте, затем крайние выводы прихватываются каплей припоя, после чего можно безболезненно использовать метод "drag soldering" для запаивания остальных выводов, предварительно нанеся достаточный слой флюс-геля или жидкого флюса. Качество пайки проверяется с помощью мощного увеличительного стекла или микроскопа. Остатки флюса или флюс-геля удаляется с помощью спиртовых салфеток и/или спирто-бензиновой смеси, после чего плата сушится.

Затем порядок запаивания остальных деталей не столь принципиален. Я сначала запаял DIP-корпуса панелей для микросхем, затем выводные резисторы, затем неполярные конденсаторы, диоды, транзисторы, разъемы, электролиты и т.д.

В собранную, но не прошитую плату желательно не вставлять DIP-микросхемы до первой прошивки CPLD.

## Замечания:

1) конфигурации перемычек на плате

* перемычка **JP1**: всегда в нижнем положении
* перемычки **JP2/JP3**: в зависимости от применяемой микросхемы ПЗУ (W27C512, 27C512, 27C256, AT28C256) должны быть установлены в следующем положении:
	* для W27C512 / 27C512 / 27C256: JP2 в нижнем положении, JP3 в верхнем положении
	* для AT28C256: JP2 в верхнем положении, JP3 в нижнем положении
* перемычка **JP5** служит для включения или отключения встроенного динамика (beeper). Крайнее левое положение включает динамик, крайнее правое - отключает.

2) Диодный мост **B1** я не запаивал, по причине того, что у меня стабилизированный БП на 9В. Вместо диодного моста запаиваются проволочные перемычки. Также отсутствие диодного моста позволяет расположить конденсатор **C34** горизонтально на плате, что в итоге дает возможность безболезненно закрыть корпус "резинки" :)

3) разъемы для плоского шлейфа **X7** и **X8** пленочной клавиатуры должны располагаться, как указано на фотографии собранного прототипа. Там важна ориентация разъемов.

4) вместо транзисторов **BC548** подходят любые другие транзисторы общего назначения, схожие по распиновке и характеристикам, например XXX

5) вместо транзисторов **2SA1175** можно применить отечественные **KT361**. Эммиттер транзистора - снизу, база - сверху, соотв.

6) Вместо выводных блокировочных конденсаторов можно использовать SMD-конденсаторы типоразмера **0805** или **1206**, аккуратно запаивая их сверху или снизу платы на посадочные места выводных конденсаторов.

7) Прошивка ПЗУ:

- в микросхему, емкостью 64кБ (27C512, W27C512) заливается в верхнюю и нижнюю половинки стандартная прошивка от 128 спектрума, при этом используется только та (верхняя?) половина, которая включается при A15=1.
- в микросхему, емкостью 32кБ (27C256, AT28C256) заливается стандартная прошивка от 128 спектрума.

## Процесс прошивки CPLD Altera EPM7128STC100:

* подключаем USB Blaster к разъему X6 JTAG
* подаем питание на плату
* открываем прошивку karabas_128.pof в установленном Quartus Programmer, выделяем чекбокс "program" и нажимаем кнопку "Program".
* после завершения процесса программирования, питание от платы можно отключить, также как и разъем JTAG освободить от подсоединенного USB Blaster'а
* плата готова к первому запуску

## Первый запуск

Правильно собранная плата с исправными компонентами в какой-либо настройке и наладке не нуждается.
Все дополнительные тонкие настройки можно осуществлять с помощью изменения прошивки CPLD путем ее перепрошивки, согласно пунктам из "Процесс прошивки CPLD Altera EPM7128STC100".

## Доработка для переключения режимов

Прошивкой предусмотрено переключение между режимом экрана **pentagon** и классическим режимом **ula48** (с эмуляцией "медленной памяти"). 

Для возможности переключения на лету без перепрошивки устройства с помощью комбинации клавиш **RESET+1** и **RESET+2**, участником форума zx-pk.ru **solegstar** была предложена следующая доработка: между сигналом **A11** и сигналом **N_RESET** с обратной стороны платы ставится диод, анодом к A11 и катодом к N_RESET, как показано на картинке:

![image](https://github.com/andykarpov/karabas-128/raw/master/docs/mode_switch_patch.jpg)

